# 劇情系統音頻控制功能

## 🎵 功能概述

在播放關卡前後劇情時，系統會自動暫停背景音樂，當劇情結束後再恢復播放，以提供更好的音頻體驗。

## 📋 實現細節

### 1. 劇情開始時暫停背景音樂

在 `storySystem.showIntro()` 和 `storySystem.showOutro()` 函數中：

```javascript
// 暫停背景音樂
audioSystem.stopGameMusic();
console.log("劇情播放期間暫停背景音樂");
```

### 2. 劇情結束時恢復背景音樂

#### 2.1 用戶手動跳過劇情
在鍵盤事件處理中，當用戶按任意鍵跳過劇情時：

```javascript
if (gameState === "storyIntro") {
  // 關卡開始劇情結束，開始遊戲
  gameState = "playing";
  // 恢復背景音樂
  audioSystem.playGameMusic();
  console.log("劇情結束，恢復背景音樂");
  restartGame();
} else if (gameState === "storyOutro") {
  // 關卡結束劇情結束，進入下一關或返回大廳
  // ... 處理邏輯 ...
  // 恢復背景音樂
  audioSystem.playGameMusic();
  console.log("劇情結束，恢復背景音樂");
  returnToLobby();
}
```

#### 2.2 影片自然結束
在 `storySystem.draw()` 函數中，當影片自然播放完畢時：

```javascript
if (this.currentVideo.ended) {
  this.videoEnded = true;
  // 影片自然結束時恢復背景音樂
  audioSystem.playGameMusic();
  console.log("影片自然結束，恢復背景音樂");
}
```

## 🎮 使用場景

### 關卡開始劇情
1. 玩家選擇關卡後，顯示開始劇情
2. 背景音樂自動暫停
3. 播放劇情影片或顯示劇情圖片
4. 用戶按任意鍵或影片結束後，恢復背景音樂並開始遊戲

### 關卡結束劇情
1. 玩家完成關卡後，顯示結束劇情
2. 背景音樂自動暫停
3. 播放劇情影片或顯示劇情圖片
4. 用戶按任意鍵或影片結束後，恢復背景音樂並進入下一關或返回大廳

## 🔧 技術特點

- **自動控制**：無需用戶手動操作，系統自動管理音頻
- **多種觸發方式**：支持手動跳過和自然結束兩種恢復音樂的方式
- **狀態管理**：通過 `gameState` 變數追蹤當前狀態
- **日誌記錄**：在控制台輸出音頻控制相關的日誌信息

## 📝 注意事項

1. **音頻設置保持**：暫停和恢復背景音樂不會影響用戶的音頻設置
2. **音量控制**：恢復播放時會使用用戶設定的音量
3. **錯誤處理**：如果音頻播放失敗，不會影響劇情播放
4. **兼容性**：支持影片和圖片兩種劇情顯示方式

## 🎯 用戶體驗

- **沉浸感**：劇情播放期間專注於劇情內容，不受背景音樂干擾
- **流暢性**：劇情結束後立即恢復背景音樂，保持遊戲氛圍的連續性
- **控制性**：用戶可以隨時按任意鍵跳過劇情並恢復音樂 